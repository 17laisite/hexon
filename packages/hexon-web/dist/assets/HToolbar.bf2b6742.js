var B=Object.defineProperty,E=Object.defineProperties;var w=Object.getOwnPropertyDescriptors;var y=Object.getOwnPropertySymbols;var v=Object.prototype.hasOwnProperty,P=Object.prototype.propertyIsEnumerable;var A=(t,e,s)=>e in t?B(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,u=(t,e)=>{for(var s in e||(e={}))v.call(e,s)&&A(t,s,e[s]);if(y)for(var s of y(e))P.call(e,s)&&A(t,s,e[s]);return t},D=(t,e)=>E(t,w(e));import{a as L,i as g,b as x,d as c,l as r,o as n,j as _,_ as F}from"./index.c292ff2c.js";import{a1 as d,x as b,o as H,e as j,r as K}from"./vendor.1b5f1531.js";const h=d("detail",{state:()=>({article:null,error:!1,_loading:!1,saving:!1}),getters:{loading(){return!this.error&&this._loading||!this.article},isDraft(){return L(this.article)},isPost(){return g(this.article)},isPage(){return x(this.article)}},actions:{async getArticle(t,e){const s=setTimeout(()=>{this._loading=!0},500);this.error=!1;try{const i=await c.getArticle(t,e);this.article=i}catch(i){throw console.error(i),this.error=!0,i}finally{clearTimeout(s),this._loading=!1}},async saveArticle(t){if(!!this.article){this.saving=!0;try{await c.saveArticle(g(this.article)?"post":"page",this.article.source,t)}catch(e){throw console.error(e),e}finally{this.saving=!1}}},clearArticle(){this.$reset()}}});function M(t,e,s){const{idKey:i,parentKey:a,childrenKey:o}=s,S=T(t,a);function f(p){const m=(S[p[i]]||[]).map(f);return m.length?D(u({},p),{[o]:m}):p}return t.filter(e).map(f)}function T(t,e){const s={};return t.map(i=>{const a=i[e];s[a]?s[a].push(i):s[a]=[i]}),s}const l=d("main",{state:()=>({posts:{},pages:{},categories:{},tags:{}}),actions:{async getBlogData(){const{posts:t,pages:e,tags:s,categories:i}=await c.getAllData();this.posts=r(t,"source"),this.pages=r(e,"source"),this.tags=r(s,"slug"),this.categories=r(i,"slug")},async deleteArticle(t,e){const{posts:s,pages:i,tags:a,categories:o}=await c.deleteArticle(t,e);this.posts=r(s,"source"),this.pages=r(i,"source"),this.tags=r(a,"slug"),this.categories=r(o,"slug")},async createArticle(t,e={}){const s=await c.createArticle(t,e),i=I();"post"in s?i.editArticle({type:"post",source:s.post.source}):i.editArticle({type:"page",source:s.page.source})},async publishArticle(t){const e=await c.publishArticle(t);return await this.getBlogData(),e}},getters:{articles(t){return n(t.pages).concat(n(t.posts))},allPostsList(t){return n(t.posts)},publishedPostsList(t){return this.allPostsList.filter(e=>e.published)},draftsList(t){return this.allPostsList.filter(e=>!e.published)},pagesList(t){return n(t.pages)},categoriesTree(){return M(this.categoriesList,t=>!t.parent,{idKey:"id",parentKey:"parent",childrenKey:"children"})},categoriesList(){return n(this.categories)},tagNamesList(){return n(this.tags).map(t=>t.name)},catNamesList(){return this.categoriesList.map(t=>t.name)}}}),C=b(()=>_(()=>import("./HCreateArticleModal.a9bc6161.js"),["assets/HCreateArticleModal.a9bc6161.js","assets/HCreateArticleModal.3ee0fb89.css","assets/vendor.1b5f1531.js","assets/index.c292ff2c.js","assets/index.16b42d6e.css","assets/HInput.30e7dbe4.js","assets/HInput.24c294b7.css","assets/HBaseModal.3a1767a8.js"])),k=b(()=>_(()=>import("./HSettingsModal.fb4b147f.js"),["assets/HSettingsModal.fb4b147f.js","assets/HSettingsModal.e77f0e63.css","assets/index.c292ff2c.js","assets/index.16b42d6e.css","assets/vendor.1b5f1531.js","assets/HBaseModal.3a1767a8.js","assets/HNavTitle.6cf0102c.js","assets/HNavTitle.4ff44c6e.css","assets/HNavList.81c998d2.js","assets/HNavList.135582a7.css"])),I=d("dispatcher",{state:()=>({}),actions:{showCreateArticleModal(){this.modal.create(C)},showSettingsModal(){this.modal.create(k)},createArticle(t,e){l().createArticle(t,e).then(()=>{this.notification.notify({type:"success",title:"\u65B0\u5EFA\u6210\u529F"})})},deleteArticle(t){const e=l();this.dialog.create({type:"warning",title:"\u5220\u9664\u786E\u8BA4",content:"\u5220\u9664\u540E\u9700\u624B\u52A8\u6062\u590D",actions:[{type:"common",label:"\u53D6\u6D88"},{type:"error",label:"\u5220\u9664",run:()=>{e.deleteArticle(t.type,t.source).then(()=>{this.notification.notify({type:"success",title:"\u5220\u9664\u6210\u529F"}),this.router.push({name:"home"})})}}]})},async saveArticle(t){this.loading.start(),await h().saveArticle(t).then(()=>{this.notification.notify({title:"\u4FDD\u5B58\u6210\u529F",type:"success"}),this.reloadBlogData()},s=>{throw this.notification.notify({title:"\u6587\u7AE0\u4FDD\u5B58\u5931\u8D25",desc:s.message,type:"error",duration:5e3}),s}),this.loading.stop()},editArticle(t){this.router.push({name:"edit",params:u({},t)})},viewArticle(t){this.router.push({name:"view",params:u({},t)})},getArticle(t){h().getArticle(t.type,t.source).catch(s=>{var i;((i=s==null?void 0:s.response)==null?void 0:i.status)===404?this.goHome():this.notification.notify({title:"\u6587\u7AE0\u8F7D\u5165\u5931\u8D25",desc:s.message,type:"error",duration:5e3})})},clearArticle(){h().clearArticle()},async publishArticle(t){this.dialog.create({type:"warning",title:"\u53D1\u5E03\u786E\u8BA4",content:"\u53D1\u5E03\u540E\u9700\u624B\u52A8\u6062\u590D",actions:[{type:"common",label:"\u53D6\u6D88"},{type:"info",label:"\u53D1\u5E03",run:()=>{this.doPublishArticle(t)}}]})},async doPublishArticle(t){const e="_drafts/";if(!t.startsWith(e))return;const s=a=>a.slice(e.length,-3);await l().publishArticle(s(t)).then(a=>{this.notification.notify({title:"\u53D1\u5E03\u6210\u529F",type:"success"});const o=h();o.article&&g(o.article)&&o.article.source===t&&this.router.push({name:"view",params:{source:a.source}})},a=>{this.notification.notify({title:"\u6587\u7AE0\u53D1\u5E03\u5931\u8D25",desc:a.message,type:"error",duration:5e3})})},goHome(){this.router.push({name:"home"})},reloadBlogData(){l().getBlogData().catch(e=>{this.notification.notify({title:"\u535A\u5BA2\u6570\u636E\u5237\u65B0\u5931\u8D25",desc:e.message,type:"error",actions:[{label:"\u91CD\u8BD5",run:()=>{this.reloadBlogData()}}]})})},loadBlogData(){l().getBlogData().catch(e=>{this.notification.notify({title:"\u535A\u5BA2\u6570\u636E\u8F7D\u5165\u5931\u8D25",desc:e.message,type:"error",permanent:!0})})}}}),N={},O={class:"h-toolbar h-12 flex items-center select-none flex-shrink-0"};function R(t,e){return H(),j("div",O,[K(t.$slots,"default")])}var z=F(N,[["render",R]]);export{z as H,l as a,h as b,I as u};
